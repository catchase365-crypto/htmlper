<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, interactive-widget=resizes-content">
    <title>HTMLç¼–è¾‘å™¨ Ultimate Final v4</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* --- æ ¸å¿ƒ CSS å˜é‡ç³»ç»Ÿ (é»˜è®¤: æ·±ç©ºç°) --- */
        :root {
            --bg-main: #111827;       /* ç¼–è¾‘å™¨èƒŒæ™¯ */
            --bg-ui: #1f2937;         /* å·¥å…·æ èƒŒæ™¯ */
            --border: #374151;        /* è¾¹æ¡†é¢œè‰² */
            --text-main: #e5e7eb;     /* ä»£ç é¢œè‰² */
            --text-dim: #6b7280;      /* è¾…åŠ©æ–‡å­—/è¡Œå· */
            --accent: #3b82f6;        /* å¼ºè°ƒè‰² */
            --caret: #ffffff;         /* å…‰æ ‡é¢œè‰² */
            --line-num-bg: #111827;   /* è¡Œå·åŒºèƒŒæ™¯ */
            
            /* å­—ä½“æ§åˆ¶å˜é‡ (åˆå§‹å€¼) */
            --editor-font: 'Menlo', 'Monaco', 'Courier New', monospace;
            --editor-size: 15px;      
            --editor-line-height: 24px; 
            --editor-padding: 12px;
        }

        /* åŸºç¡€å¸ƒå±€ */
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            overflow: hidden;
            background-color: var(--bg-main);
            color: var(--text-main);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }

        /* --- ç¼–è¾‘å™¨æ ¸å¿ƒç»“æ„ --- */
        .editor-container {
            position: relative;
            display: flex;
            height: 100%;
            overflow: hidden;
            background-color: var(--bg-main);
        }

        /* è¡Œå·åŒºåŸŸ */
        .line-numbers {
            width: 48px;
            flex-shrink: 0;
            background-color: var(--line-num-bg);
            color: var(--text-dim);
            text-align: right;
            padding: var(--editor-padding) 6px var(--editor-padding) 0;
            font-family: var(--editor-font);
            font-size: var(--editor-size);
            line-height: var(--editor-line-height);
            border-right: 1px solid var(--border);
            user-select: none;
            overflow: hidden;
            white-space: pre; 
        }
        /* éšè—ç±»ï¼Œç”¨äº JS æ§åˆ¶ */
        .hidden {
            display: none !important;
        }

        /* ä»£ç è¾“å…¥åŒºåŸŸ */
        textarea#codeArea {
            flex-grow: 1;
            background-color: var(--bg-main);
            color: var(--text-main);
            border: none;
            margin: 0;
            padding: var(--editor-padding);
            font-family: var(--editor-font);
            font-size: var(--editor-size);
            line-height: var(--editor-line-height);
            outline: none;
            resize: none;
            white-space: pre; 
            overflow: auto;
            caret-color: var(--caret);
            tab-size: 2;
        }

        /* --- UI ç»„ä»¶æ ·å¼ --- */
        .ui-panel {
            background-color: var(--bg-ui);
            border-bottom: 1px solid var(--border);
        }

        .icon-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 6px 10px;
            border-radius: 6px;
            background-color: rgba(255,255,255,0.05);
            color: var(--text-main);
            border: 1px solid var(--border);
            transition: all 0.2s;
            font-size: 14px;
            cursor: pointer;
            user-select: none;
        }
        .icon-btn:active { transform: scale(0.96); opacity: 0.8; }
        
        /* å­—ä½“æŒ‰é’®æ ·å¼ */
        .font-btn {
            padding: 4px 10px;
            font-size: 13px;
            background-color: var(--bg-main);
            color: var(--text-main);
            border: 1px solid var(--border);
            cursor: pointer;
            user-select: none;
        }
        .font-btn:hover { filter: brightness(1.2); }
        .font-btn:active { background-color: var(--bg-ui); }

        /* å¿«æ·é”®æ  */
        .quick-bar {
            overflow-x: auto;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .quick-bar::-webkit-scrollbar { display: none; }

        /* æ»šåŠ¨æ¡ç¾åŒ– */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--text-dim); border-radius: 3px; opacity: 0.3; }

        ::selection { background-color: var(--accent); color: white; }
    </style>
</head>
<body class="flex flex-col h-[100dvh]">

    <!-- 1. é¡¶éƒ¨å·¥å…·æ  -->
    <header class="ui-panel p-2 flex items-center justify-between shrink-0 z-30 shadow-sm relative">
        <div class="flex items-center gap-2">
            <label class="icon-btn" title="æ‰“å¼€æ–‡ä»¶">
                ğŸ“‚ <span class="hidden sm:inline ml-1 text-xs opacity-70">æ‰“å¼€</span>
                <input type="file" id="fileInput" accept=".html,.htm,.txt" class="hidden">
            </label>
            <button onclick="toggleThemePanel()" class="icon-btn" title="åˆ‡æ¢ä¸»é¢˜ä¸è®¾ç½®">
                ğŸ¨ <span class="hidden sm:inline ml-1 text-xs opacity-70">è®¾ç½®</span>
            </button>
            <div class="flex gap-1 ml-1 border-l border-[var(--border)] pl-2">
                <button onclick="editorUndo()" class="icon-btn w-8 px-0" title="æ’¤é”€">â†©</button>
                <button onclick="editorRedo()" class="icon-btn w-8 px-0" title="é‡åš">â†ª</button>
            </div>
        </div>

        <div class="flex items-center gap-2">
            <button onclick="runCode()" class="icon-btn border-green-900/50 text-green-400 bg-green-900/10">
                â–¶ è¿è¡Œ
            </button>
            <button onclick="downloadCode()" class="icon-btn border-blue-900/50 text-blue-400 bg-blue-900/10">
                â¬‡ ä¸‹è½½
            </button>
        </div>
    </header>

    <!-- 2. ä¸»é¢˜/è®¾ç½®é¢æ¿ (å«è¡Œå·å¼€å…³ã€å¿«æ·æ å¼€å…³) -->
    <div id="themePanel" class="hidden absolute top-14 left-4 z-50 bg-[var(--bg-ui)] border border-[var(--border)] p-2 rounded-xl shadow-2xl animate-fade-in w-48 max-h-[60vh] overflow-y-auto">
        <!-- è¡Œå·å¼€å…³ -->
        <button onclick="toggleLineNumbers()" class="w-full text-left px-3 py-2 rounded text-sm hover:brightness-110 transition flex items-center gap-2 mb-2 text-[var(--text-main)] bg-[var(--bg-main)] border border-[var(--border)]">
            <span>ğŸ”¢</span> <span id="lineNumToggleText">éšè—è¡Œå·</span>
        </button>
        
        <!-- æ–°å¢ï¼šå¿«æ·æ å¼€å…³ -->
        <button onclick="toggleQuickBar()" class="w-full text-left px-3 py-2 rounded text-sm hover:brightness-110 transition flex items-center gap-2 mb-2 text-[var(--text-main)] bg-[var(--bg-main)] border border-[var(--border)]">
            <span>âš¡</span> <span id="quickBarToggleText">éšè—å¿«æ·æ </span>
        </button>
        
        <div class="w-full h-[1px] bg-[var(--border)] mb-2"></div>

        <div class="text-xs text-[var(--text-dim)] mb-2 px-2 text-center">é€‰æ‹©ä¸»é¢˜</div>
        <div id="themeList" class="flex flex-col gap-1">
            <!-- åŠ¨æ€ç”Ÿæˆæ–‡å­—æŒ‰é’® -->
        </div>
    </div>

    <!-- 3. æœç´¢ä¸å­—ä½“æ§åˆ¶æ  (ç¬¬äºŒè¡Œ) -->
    <div class="ui-panel p-1.5 flex flex-nowrap items-center gap-2 shrink-0 z-20">
        <div class="flex items-center flex-grow bg-[var(--bg-main)] rounded border border-[var(--border)] px-2 py-1 transition-colors focus-within:border-[var(--accent)] min-w-0">
            <input type="text" id="searchInput" placeholder="æœç´¢..." class="bg-transparent border-none text-sm text-[var(--text-main)] focus:outline-none w-full min-w-[20px]">
            <span id="searchCount" class="text-xs text-[var(--text-dim)] whitespace-nowrap px-1"></span>
        </div>
        
        <div class="flex items-center gap-1 shrink-0">
            <button onclick="navigateSearch(-1)" class="icon-btn w-8 h-8 px-0">â¬†</button>
            <button onclick="navigateSearch(1)" class="icon-btn w-8 h-8 px-0">â¬‡</button>
        </div>

        <div class="w-[1px] h-6 bg-[var(--border)] mx-1 shrink-0"></div>

        <div class="flex items-center rounded overflow-hidden border border-[var(--border)] shrink-0">
            <button onclick="changeFontSize(-1)" class="font-btn border-r border-[var(--border)]">A-</button>
            <button onclick="changeFontSize(1)" class="font-btn">A+</button>
        </div>
    </div>

    <!-- 4. å¿«æ·ç¬¦å·æ  (æ·»åŠ äº†IDä»¥ä¾¿æ§åˆ¶) -->
    <div id="quickBar" class="ui-panel p-1 shrink-0 quick-bar whitespace-nowrap flex items-center gap-2 px-2 h-10 border-none">
        <span class="text-[10px] text-[var(--text-dim)] uppercase tracking-wider mr-1">Quick:</span>
        <button onclick="insertText('<div class=\x22\x22></div>', 12)" class="icon-btn text-xs py-1">&lt;div&gt;</button>
        <button onclick="insertText('<p></p>', 4)" class="icon-btn text-xs py-1">&lt;p&gt;</button>
        <button onclick="insertText('<a href=\x22\x22></a>', 9)" class="icon-btn text-xs py-1">&lt;a&gt;</button>
        <button onclick="insertText('img src=\x22\x22', 9)" class="icon-btn text-xs py-1">img</button>
        <span class="w-[1px] h-4 bg-[var(--border)] mx-1"></span>
        <button onclick="insertText('=')" class="icon-btn text-xs w-6 px-0">=</button>
        <button onclick="insertText('\x22')" class="icon-btn text-xs w-6 px-0">"</button>
        <button onclick="insertText('/')" class="icon-btn text-xs w-6 px-0">/</button>
        <button onclick="insertText('&gt;')" class="icon-btn text-xs w-6 px-0">&gt;</button>
        <button onclick="insertText(';')" class="icon-btn text-xs w-6 px-0">;</button>
        <button onclick="insertText('  ')" class="icon-btn text-xs px-2">Tab</button>
    </div>

    <!-- 5. ç¼–è¾‘å™¨æ ¸å¿ƒåŒºåŸŸ -->
    <main class="editor-container">
        <!-- è¡Œå· -->
        <div id="lineNumbers" class="line-numbers">1</div>
        <!-- æ–‡æœ¬æ¡† -->
        <textarea id="codeArea" spellcheck="false" autocapitalize="off" autocomplete="off" autocorrect="off" placeholder="åœ¨æ­¤è¾“å…¥ HTML ä»£ç ..."></textarea>
    </main>

    <script>
        // --- 1. é…ç½®ä¸ä¸»é¢˜ç³»ç»Ÿ ---
        const themes = [
            { name: "æ·±ç©ºç° (é»˜è®¤)", bg: "#111827", ui: "#1f2937", text: "#e5e7eb", accent: "#3b82f6" },
            { name: "OLED çº¯é»‘", bg: "#000000", ui: "#111111", text: "#e0e0e0", accent: "#ffffff" },
            { name: "é»‘å®¢ç»¿", bg: "#0d1117", ui: "#161b22", text: "#4ade80", accent: "#22c55e" },
            { name: "äº®è‰²æ¨¡å¼", bg: "#ffffff", ui: "#f3f4f6", text: "#24292f", accent: "#0969da", border: "#e5e7eb", dim: "#6e7781" },
            { name: "æµ·æ´‹è“", bg: "#0f172a", ui: "#1e293b", text: "#94a3b8", accent: "#38bdf8" },
            { name: "å’–å•¡å¤§åœ°", bg: "#292524", ui: "#44403c", text: "#ea580c", accent: "#ea580c" },
            { name: "èµ›åšæœ‹å…‹", bg: "#0b001a", ui: "#240046", text: "#ff00ff", accent: "#00ffff" },
            { name: "è«å…°è¿ªç²‰", bg: "#fdf2f8", ui: "#fce7f3", text: "#831843", accent: "#db2777", border: "#fbcfe8" },
            { name: "Monokai", bg: "#272822", ui: "#3e3d32", text: "#a6e22e", accent: "#a6e22e" },
        ];

        // å…ƒç´ ç»‘å®š
        const codeArea = document.getElementById('codeArea');
        const lineNumbers = document.getElementById('lineNumbers');
        const themePanel = document.getElementById('themePanel');
        const themeList = document.getElementById('themeList');
        const searchInput = document.getElementById('searchInput');
        const quickBar = document.getElementById('quickBar');

        // çŠ¶æ€
        let currentFileName = "index";
        let historyStack = [];
        let historyIndex = -1;
        const MAX_HISTORY = 100;
        let debounceTimer;

        // --- 2. åˆå§‹åŒ– ---
        window.onload = function() {
            initThemes(); 
            
            // æ¢å¤å†…å®¹
            const saved = localStorage.getItem('html_editor_ult_content');
            if (saved) {
                codeArea.value = saved;
                saveHistory();
            } else {
                saveHistory();
            }

            // æ¢å¤ä¸»é¢˜
            const savedThemeIdx = localStorage.getItem('html_editor_theme_idx');
            applyTheme(savedThemeIdx ? parseInt(savedThemeIdx) : 0);
            
            // æ¢å¤å­—å·
            const savedSize = localStorage.getItem('html_editor_font_size');
            if (savedSize) applyFontSize(parseInt(savedSize));

            // æ¢å¤è¡Œå·æ˜¾ç¤ºçŠ¶æ€
            const savedLineNumState = localStorage.getItem('html_editor_linenum_visible');
            if (savedLineNumState === 'false') {
                lineNumbers.classList.add('hidden');
                document.getElementById('lineNumToggleText').textContent = "æ˜¾ç¤ºè¡Œå·";
            }

            // æ¢å¤å¿«æ·æ æ˜¾ç¤ºçŠ¶æ€ (æ–°å¢)
            const savedQuickBarState = localStorage.getItem('html_editor_quickbar_visible');
            if (savedQuickBarState === 'false') {
                quickBar.classList.add('hidden');
                document.getElementById('quickBarToggleText').textContent = "æ˜¾ç¤ºå¿«æ·æ ";
            }

            updateLineNumbers();
        };

        // --- 3. ç•Œé¢å…ƒç´ å¼€å…³ ---
        
        // è¡Œå·å¼€å…³
        function toggleLineNumbers() {
            const btnText = document.getElementById('lineNumToggleText');
            const isHidden = lineNumbers.classList.contains('hidden');
            
            if (isHidden) {
                lineNumbers.classList.remove('hidden');
                btnText.textContent = "éšè—è¡Œå·";
                localStorage.setItem('html_editor_linenum_visible', 'true');
                updateLineNumbers(); 
            } else {
                lineNumbers.classList.add('hidden');
                btnText.textContent = "æ˜¾ç¤ºè¡Œå·";
                localStorage.setItem('html_editor_linenum_visible', 'false');
            }
        }

        // å¿«æ·æ å¼€å…³ (æ–°å¢)
        function toggleQuickBar() {
            const btnText = document.getElementById('quickBarToggleText');
            const isHidden = quickBar.classList.contains('hidden');

            if (isHidden) {
                quickBar.classList.remove('hidden');
                btnText.textContent = "éšè—å¿«æ·æ ";
                localStorage.setItem('html_editor_quickbar_visible', 'true');
            } else {
                quickBar.classList.add('hidden');
                btnText.textContent = "æ˜¾ç¤ºå¿«æ·æ ";
                localStorage.setItem('html_editor_quickbar_visible', 'false');
            }
            // é‡æ–°è®¡ç®—è¡Œå·ï¼Œé˜²æ­¢é«˜åº¦çªå˜å¯¼è‡´çš„çŸ­æš‚é”™ä½ï¼ˆè™½ç„¶æœ‰Flexboxï¼Œä½†æ›´ç¨³å¦¥ï¼‰
            setTimeout(updateLineNumbers, 0);
        }

        // --- 4. å­—ä½“å¤§å°æ§åˆ¶ ---
        function changeFontSize(delta) {
            const root = document.documentElement;
            const currentSize = parseInt(getComputedStyle(root).getPropertyValue('--editor-size'));
            let newSize = currentSize + delta;
            if (newSize < 10) newSize = 10;
            if (newSize > 32) newSize = 32;
            applyFontSize(newSize);
        }

        function applyFontSize(size) {
            const root = document.documentElement;
            const lineHeight = Math.round(size * 1.6);
            root.style.setProperty('--editor-size', size + 'px');
            root.style.setProperty('--editor-line-height', lineHeight + 'px');
            localStorage.setItem('html_editor_font_size', size);
            setTimeout(updateLineNumbers, 0);
        }

        // --- 5. æ ¸å¿ƒï¼šè¡Œå·ä¸æ»šåŠ¨ ---
        const updateLineNumbers = () => {
            if (lineNumbers.classList.contains('hidden')) return;

            const val = codeArea.value;
            const lines = val.split('\n').length;
            
            const lh = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--editor-line-height'));
            const minLines = Math.floor(window.innerHeight / lh);
            const count = Math.max(lines, minLines);
            
            lineNumbers.textContent = Array.from({length: count}, (_, i) => i + 1).join('\n');
        };

        codeArea.addEventListener('scroll', () => {
            if (!lineNumbers.classList.contains('hidden')) {
                lineNumbers.scrollTop = codeArea.scrollTop;
            }
        });

        // --- 6. ä¸»é¢˜ç³»ç»Ÿ ---
        function initThemes() {
            themeList.innerHTML = '';
            themes.forEach((t, idx) => {
                const btn = document.createElement('button');
                btn.className = 'w-full text-left px-3 py-2 rounded text-sm hover:brightness-110 transition flex items-center justify-between group';
                btn.style.backgroundColor = t.bg;
                btn.style.color = t.text;
                btn.style.border = `1px solid ${t.border || '#374151'}`;
                
                const span = document.createElement('span');
                span.textContent = t.name;
                btn.appendChild(span);

                const accentDot = document.createElement('div');
                accentDot.className = 'w-3 h-3 rounded-full';
                accentDot.style.backgroundColor = t.accent;
                btn.appendChild(accentDot);

                btn.onclick = () => {
                    applyTheme(idx);
                    toggleThemePanel();
                };
                themeList.appendChild(btn);
            });
        }

        function applyTheme(idx) {
            const t = themes[idx];
            const root = document.documentElement;
            root.style.setProperty('--bg-main', t.bg);
            root.style.setProperty('--bg-ui', t.ui);
            root.style.setProperty('--text-main', t.text);
            root.style.setProperty('--accent', t.accent);
            root.style.setProperty('--border', t.border || '#374151');
            root.style.setProperty('--text-dim', t.dim || '#6b7280');
            root.style.setProperty('--line-num-bg', t.bg);
            
            const lineNumDiv = document.getElementById('lineNumbers');
            if(lineNumDiv) lineNumDiv.style.backgroundColor = t.bg;

            localStorage.setItem('html_editor_theme_idx', idx);
        }

        function toggleThemePanel() {
            themePanel.classList.toggle('hidden');
        }

        // --- 7. æ’¤é”€/é‡åš & è¾“å…¥ç›‘å¬ ---
        function saveHistory() {
            const currentVal = codeArea.value;
            if (historyIndex > -1 && historyStack[historyIndex] === currentVal) return;
            if (historyIndex < historyStack.length - 1) {
                historyStack = historyStack.slice(0, historyIndex + 1);
            }
            historyStack.push(currentVal);
            if (historyStack.length > MAX_HISTORY) historyStack.shift();
            else historyIndex++;
        }

        codeArea.addEventListener('input', () => {
            updateLineNumbers();
            localStorage.setItem('html_editor_ult_content', codeArea.value);
            if (searchInput.value) performSearch(searchInput.value, false);
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(saveHistory, 500);
        });

        function editorUndo() {
            if (historyIndex > 0) {
                historyIndex--;
                codeArea.value = historyStack[historyIndex];
                updateLineNumbers();
                localStorage.setItem('html_editor_ult_content', codeArea.value);
            }
        }

        function editorRedo() {
            if (historyIndex < historyStack.length - 1) {
                historyIndex++;
                codeArea.value = historyStack[historyIndex];
                updateLineNumbers();
                localStorage.setItem('html_editor_ult_content', codeArea.value);
            }
        }

        // --- 8. æœç´¢åŠŸèƒ½ ---
        let searchMatches = [];
        let currentMatchIdx = -1;

        searchInput.addEventListener('input', function() { performSearch(this.value, false); });
        searchInput.addEventListener('keydown', function(e) { if(e.key === 'Enter') { e.preventDefault(); navigateSearch(1); }});

        function performSearch(term, jump) {
            searchMatches = [];
            if(!jump) currentMatchIdx = -1;
            const countSpan = document.getElementById('searchCount');
            if(!term) { countSpan.textContent = ''; return; }

            const val = codeArea.value.toLowerCase();
            const lowerTerm = term.toLowerCase();
            let pos = val.indexOf(lowerTerm);
            while(pos !== -1) {
                searchMatches.push(pos);
                pos = val.indexOf(lowerTerm, pos + 1);
            }
            countSpan.textContent = searchMatches.length > 0 ? `?/${searchMatches.length}` : '0/0';
            countSpan.style.color = searchMatches.length > 0 ? 'var(--accent)' : 'red';
            if(jump && searchMatches.length > 0) navigateSearch(1);
        }

        function navigateSearch(dir) {
            if(searchMatches.length === 0) return;
            if(currentMatchIdx === -1) currentMatchIdx = 0;
            else currentMatchIdx += dir;
            if(currentMatchIdx >= searchMatches.length) currentMatchIdx = 0;
            if(currentMatchIdx < 0) currentMatchIdx = searchMatches.length - 1;

            const idx = searchMatches[currentMatchIdx];
            codeArea.focus();
            codeArea.setSelectionRange(idx, idx + searchInput.value.length);
            
            const lh = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--editor-line-height'));
            const lines = codeArea.value.substr(0, idx).split('\n').length;
            codeArea.scrollTop = (lines * lh) - (codeArea.clientHeight / 2);
            
            document.getElementById('searchCount').textContent = `${currentMatchIdx + 1}/${searchMatches.length}`;
        }

        // --- 9. æ–‡ä»¶æ“ä½œ & è¾…åŠ© ---
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if(!file) return;
            currentFileName = file.name.replace(/\.[^/.]+$/, "");
            const reader = new FileReader();
            reader.onload = function(e) {
                codeArea.value = e.target.result;
                updateLineNumbers();
                saveHistory();
                localStorage.setItem('html_editor_ult_content', codeArea.value);
            };
            reader.readAsText(file);
            this.value = '';
        });

        function insertText(text, offset = 0) {
            const start = codeArea.selectionStart;
            const end = codeArea.selectionEnd;
            codeArea.value = codeArea.value.substring(0, start) + text + codeArea.value.substring(end);
            const newPos = start + text.length - offset;
            codeArea.setSelectionRange(newPos, newPos);
            codeArea.focus();
            updateLineNumbers();
            saveHistory();
        }

        function runCode() {
            const w = window.open("", "_blank");
            if(w) { w.document.write(codeArea.value); w.document.close(); }
            else alert("è¯·å…è®¸å¼¹çª—");
        }

        function downloadCode() {
            const now = new Date();
            const ts = `${String(now.getMinutes()).padStart(2,'0')}${String(now.getSeconds()).padStart(2,'0')}`;
            const blob = new Blob([codeArea.value], {type:'text/html'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentFileName}_${ts}.html`;
            document.body.appendChild(a); a.click(); document.body.removeChild(a);
        }
    </script>
</body>
</html>

